@model IEnumerable<Infraestructure.Models.Producto>

@{
    ViewBag.Title = "Lista de Productos";
}

<h2>Lista de Productos</h2>

<p>
    @*@Html.ActionLink("Create New", "Create")*@
    <a title="Permite crear un nuevo Producto" class="btn" style="background-color: #1319c4; color: white" onclick="modalCreate(null)" href="#">Crear Nuevo</a>
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Descripcion)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Imagen)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.PrecioUnidad)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.IVA)
        </th>
        <th>
            @Html.DisplayName("Marca")
        </th>
        <th>
            @Html.DisplayName("Tipo"))
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Descripcion)
            </td>
            <td>
                <input class="zoom" type="image" src="data:image/jpeg;charset=utf-8;base64,@Convert.ToBase64String(item.Imagen)" id="ImagenActivo" style="height:75px;width:75px">
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.PrecioUnidad)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.IVA)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.MarcaProducto.Descripcion)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.TipoProducto.Descripcion)
            </td>
            <td>
                <a title="Click para editar los valores del Producto" class="btn" style="background-color: #1319c4; color: white" onclick="modalEdit(@item.Id)" href="#">Editar</a>
                <a title="Click para ver los detalles del Producto" class="btn" style="background-color: lightgray; color: black" onclick="modalDetail(@item.Id)" href="#">Detalles</a>
                <a title="Click para desactivar el Producto" class="btn" style="background-color: #d61717; color: white" onclick="modalDelete(@item.Id)" href="#">Desactivar</a>
            </td>
        </tr>
    }

</table>

<input type="hidden" id="campoOculto" />

<!-- ModalDetalles ------------------------------------------------------------------------------------------------------->
<!--Las ventanas modas estan ocultas en el código son activadas por Javascript/JQuery-->
<div class="modal fade" id="modalDetails" tabindex="-1" role="dialog" aria-labelledby="modalDetailsLabel" style="margin-top: 10%">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="modalDetailsLabel">RB's Spare</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- ModalDelete -------------------------------------------------------------------------------------------------------->
<!--Las ventanas modas estan ocultas en el código son activadas por Javascript/JQuery-->
<div class="modal fade" id="modalDelete" tabindex="-1" role="dialog" aria-labelledby="modalDetailsLabel" style="margin-top: 10%">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="modalDetailsLabel">RB's Spare</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- ModalEdit -------------------------------------------------------------------------------------------------------->
<!--Las ventanas modas estan ocultas en el código son activadas por Javascript/JQuery-->
<div class="modal fade" id="modalEdit" tabindex="-1" role="dialog" aria-labelledby="modalDetailsLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="modalDetailsLabel">RB's Spare</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- ModalCreate -------------------------------------------------------------------------------------------------------->
<!--Las ventanas modas estan ocultas en el código son activadas por Javascript/JQuery-->
<div class="modal fade" id="modalCreate" tabindex="-1" role="dialog" aria-labelledby="modalDetailsLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="modalDetailsLabel">RB's Spare</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/toastjs")
    @Scripts.Render("~/bundles/jqueryui")

    @*Scripts para validaciones*@
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

    @*Para el Toast*@
    <script>

        $(document).ready(function () {
             console.log("Entro a JQuery")

                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "400",
                    "hideDuration": "1000",
                    "timeOut": "3000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }

                // Recibe los parámetros del Controller
                var option = '@ViewBag.Action'
                var message = '@ViewBag.Message'


                if (option == 'S') {
                    toastr.success("El registro fue salvado correctamente");
                }


                 if (option == 'D') {
                     toastr.success("El registro fue borrado correctamente");
                }


                 if (option == 'U') {
                     toastr.success("El registro fue actualizado correctamente");
                }

                if (option == 'E') {
                    toastr.warning("Se ha producido un error :"+message);
            }


            // Cambiar el color del fondo del Grid.
            //$(".table tbody tr:even").css("background-color", "#ddd");
        });



    </script>

    @*Scrip para Detalles*@
    <script>
        function modalDetail(p) {
            // Almacena el Id del Empleado en el hidden field tipo variable global
            $("#campoOculto").val(p);
            // $("#modalDetails").val(p);
            //var temp = $("#campoOculto").val();
            // Invoca al Div de Modal de una vez se invoca el evento shown.bs.modal
            // donde se invoca al Ajax con el Partial View
            $("#modalDetails").modal();
        }
    </script>

    <script>

        // Este evento se ejecuta antes después de invocar  $("#modalDetails").modal();
        // acá es donde se invoca por Ajax al Controller y este devuelve Partial View
        $('#modalDetails').on('shown.bs.modal', function () {
            // permite mover
            $('.modal-dialog').draggable();
            // Se lee el campo oculto
            var idEmpleado = $("#campoOculto").val();
            //var identificacionEstudiante = $("#modalDetails").val();
            console.log(idEmpleado);
            $.ajax({
                type: "GET",
                url: "/Producto/AjaxFilterDetails/",
                // parametro por JSON
                data: { id: idEmpleado },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $(".modal-body").html(data);
                },
                // Capturar errores y mostrar un mensaje de error
                error: function (xhr, status, error) {
                    var mensaje = "<div class='alert alert-danger' role='alert'> Result: " +
                        status + " " + error + " " + xhr.status + " " + xhr.statusText + "</div>";
                    //debugger;
                    $("#mensaje").html(mensaje).show("slow").delay(1000).hide("slow");
                }
            });

        })

        // Se ejecuta cuando se destruye el modal
        $("#modalDetails").on('hide.bs.modal', function () {
            // Se limpia el Div para no dejar
            $(".modal-body").html("...");
        });

    </script>

    @*Script para Delete*@
    <script>
        function modalDelete(p) {
            // Almacena el Id del Empleado en el hidden field tipo variable global
            $("#campoOculto").val(p);
            // $("#modalDetails").val(p);
            //var temp = $("#campoOculto").val();
            // Invoca al Div de Modal de una vez se invoca el evento shown.bs.modal
            // donde se invoca al Ajax con el Partial View
            $("#modalDelete").modal();
        }
    </script>
    <script>

        // Este evento se ejecuta antes después de invocar  $("#modalDetails").modal();
        // acá es donde se invoca por Ajax al Controller y este devuelve Partial View
        $('#modalDelete').on('shown.bs.modal', function () {
            // permite mover
            $('.modal-dialog').draggable();
            // Se lee el campo oculto
            var idEmpleado = $("#campoOculto").val();
            //var identificacionEstudiante = $("#modalDetails").val();
            console.log(idEmpleado);
            $.ajax({
                type: "GET",
                url: "/Producto/Delete/",
                // parametro por JSON
                data: { id: idEmpleado },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $(".modal-body").html(data);
                },
                // Capturar errores y mostrar un mensaje de error
                error: function (xhr, status, error) {
                    var mensaje = "<div class='alert alert-danger' role='alert'> Result: " +
                        status + " " + error + " " + xhr.status + " " + xhr.statusText + "</div>";
                    //debugger;
                    $("#mensaje").html(mensaje).show("slow").delay(1000).hide("slow");
                }
            });

        })

        // Se ejecuta cuando se destruye el modal
        $("#modalDelete").on('hide.bs.modal', function () {
            // Se limpia el Div para no dejar
            $(".modal-body").html("...");
        });

    </script>

    @*Script para Edit*@
    <script>
        function modalEdit(p) {
            // Almacena el Id del Empleado en el hidden field tipo variable global
            $("#campoOculto").val(p);
            // $("#modalDetails").val(p);
            //var temp = $("#campoOculto").val();
            // Invoca al Div de Modal de una vez se invoca el evento shown.bs.modal
            // donde se invoca al Ajax con el Partial View
            $("#modalEdit").modal();
        }
    </script>
    <script>

        // Este evento se ejecuta antes después de invocar  $("#modalDetails").modal();
        // acá es donde se invoca por Ajax al Controller y este devuelve Partial View
        $('#modalEdit').on('shown.bs.modal', function () {
            // permite mover
            $('.modal-dialog').draggable();
            // Se lee el campo oculto
            var idEmpleado = $("#campoOculto").val();
            //var identificacionEstudiante = $("#modalDetails").val();
            console.log(idEmpleado);
            $.ajax({
                type: "GET",
                url: "/Producto/Edit/",
                // parametro por JSON
                data: { id: idEmpleado },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $(".modal-body").html(data);

                    //The validation plugin can't bind to the same form twice.
                    //We need to remove existing validators
                    $('modalEdit').removeData("validator");

                    //Refresh the validators
                    $.validator.unobtrusive.parse(document);
                },
                // Capturar errores y mostrar un mensaje de error
                error: function (xhr, status, error) {
                    var mensaje = "<div class='alert alert-danger' role='alert'> Result: " +
                        status + " " + error + " " + xhr.status + " " + xhr.statusText + "</div>";
                    //debugger;
                    $("#mensaje").html(mensaje).show("slow").delay(1000).hide("slow");
                }
            });

        })

        // Se ejecuta cuando se destruye el modal
        $("#modalEdit").on('hide.bs.modal', function () {
            // Se limpia el Div para no dejar
            $(".modal-body").html("...");
        });

    </script>

    @*Script para Create*@
    <script>
        function modalCreate(p) {
            // Almacena el Id del Empleado en el hidden field tipo variable global
            $("#campoOculto").val(p);
            // $("#modalDetails").val(p);
            //var temp = $("#campoOculto").val();
            // Invoca al Div de Modal de una vez se invoca el evento shown.bs.modal
            // donde se invoca al Ajax con el Partial View
            $("#modalCreate").modal();
        }
    </script>
    <script>

        // Este evento se ejecuta antes después de invocar  $("#modalDetails").modal();
        // acá es donde se invoca por Ajax al Controller y este devuelve Partial View
        $('#modalCreate').on('shown.bs.modal', function () {

            // permite mover
            $('.modal-dialog').draggable();
            // Se lee el campo oculto
            var idEmpleado = $("#campoOculto").val();
            //var identificacionEstudiante = $("#modalDetails").val();
            console.log(idEmpleado);
            $.ajax({
                type: "GET",
                url: "/Producto/Create/",
                // parametro por JSON
                data: { id: idEmpleado },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $(".modal-body").html(data);

                    //The validation plugin can't bind to the same form twice.
                    //We need to remove existing validators
                    $('modalCreate').removeData("validator");

                    //Refresh the validators
                    $.validator.unobtrusive.parse(document);
                },
                // Capturar errores y mostrar un mensaje de error
                error: function (xhr, status, error) {
                    var mensaje = "<div class='alert alert-danger' role='alert'> Result: " +
                        status + " " + error + " " + xhr.status + " " + xhr.statusText + "</div>";
                    //debugger;
                    $("#mensaje").html(mensaje).show("slow").delay(1000).hide("slow");
                }
            });

        })

        // Se ejecuta cuando se destruye el modal
        $("#modalCreate").on('hide.bs.modal', function () {
            // Se limpia el Div para no dejar
            $(".modal-body").html("...");
        });

    </script>
}

<style>
    /* Cuando el puntero del Mouse se coloque encima de la imagen la amplia, es un efecto para que se vea
            bonito :)
        */
    <!-- Hacer + grande a imagen sobre la image -->
    .zoom {
    }

    .zoom:hover {
        transform: scale(2.5); /* (250% zoom - Note: if the zoom is too large, it will go outside of the viewport) */
    }
</style>


